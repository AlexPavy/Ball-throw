<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ball throw</title>
    <style>

        .frame {
            width: 1000px;
            height: 600px;
            border: 3px #111111;
            margin: 10px;
            background-color: #d8d7ea;
            position: relative;
        }

        #ball {
            position: absolute;
            height: 10px;
            width: 10px;
            background-color: #00801b;
            border-radius: 50%;
            display: block;
            left: 20px;
            top: 200px;
        }

    </style>
    <script>
        console.log("Falling ball");

        const FREQ = 3; // milliseconds
        const BALL_SIZE = 10; // px
        const MAX_Y = 600 - BALL_SIZE; // px
        const MIN_Y = BALL_SIZE; // px
        const MAX_X = 1000 - BALL_SIZE; // px
        const MIN_X = BALL_SIZE; // px

        const GROUND_SLOW_FACTOR = 1.3; // no unit
        var x = 20; // px
        var y = 200; // px
        const g = 0.001; // px / milliseconds^2
        var ball; // dom element

        var v_x = 0; // px / milliseconds
        var v_y = 0; // px / milliseconds
        var t1; // milliseconds

        function move() {
            const now = new Date().getTime();
            var t = now - t1;
            t1 = now;
            console.log(`x:${x} ; y:${y} ; v_x:${v_x} ; v_y:${v_y} ; t:${t}`);

            if ((MAX_Y - y) < 1 && Math.abs(v_y) < 0.001 && Math.abs(v_x) < 0.001) {
                v_x = 0;
                v_y = 0;
                display();
                return;
            }

            if (!ball) ball = document.getElementById('ball');
            if (ball) {
                // display();
                // return;
                v_y += g * t;
                y += v_y * t;
                x += v_x * t;
                if (y > MAX_Y) {
                    y = 2 * MAX_Y - y;
                    v_y = -(v_y / GROUND_SLOW_FACTOR);
                    v_x = v_x / GROUND_SLOW_FACTOR;
                }
                if (y < MIN_Y) {
                    y = 2 * MIN_Y - y;
                    v_y = -(v_y / GROUND_SLOW_FACTOR);
                    v_x = v_x / GROUND_SLOW_FACTOR;
                }
                if (x > MAX_X) {
                    x = 2 * MAX_X - x;
                    v_y = v_y / GROUND_SLOW_FACTOR;
                    v_x = -(v_x / GROUND_SLOW_FACTOR);
                }
                if (x < MIN_X) {
                    x = 2 * MIN_X - x;
                    v_y = v_y / GROUND_SLOW_FACTOR;
                    v_x = -(v_x / GROUND_SLOW_FACTOR);
                }
                if (y < 0) {
                    y = MAX_Y;
                    v_y = 0;
                }

                display();
            }

            setTimeout(move, FREQ);
        }

        function display() {
            if (!ball) ball = document.getElementById('ball');
            if (ball) {
                ball.style.left = x + "px";
                ball.style.top = y + "px";
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            display();

            document.getElementById("start-btn").addEventListener("click", function() {
                var init_v_x_btn = document.getElementById("init-v_x-btn");
                var init_v_y_btn = document.getElementById("init-v_y-btn");
                v_x += parseFloat(init_v_x_btn.value);
                v_y += parseFloat(init_v_y_btn.value);
                t1 = new Date().getTime();
                move();
            });
        });

    </script>
</head>
<body>
<h1>Ball throw</h1>

<span>x-speed:</span><input id="init-v_x-btn" type="number" value="0.2">
<span>y-speed:</span><input id="init-v_y-btn" type="number" value="-0.2">
<input id="start-btn" type="button" value="Start">

<div class="frame">
    <span id="ball"></span>
</div>

</body>
</html>
